{"version":3,"sources":["../../src/pages/crm-op-form/crm-op-form.module.ts","../../src/pipes/pipes.module.ts","../../src/pages/crm-op-form/crm-op-form.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAyC;AACO;AACF;AAES;AAavD;IAAA;IAAkC,CAAC;IAAtB,mBAAmB;QAX/B,+DAAQ,CAAC;YACR,YAAY,EAAE;gBACZ,mEAAa;aACd;YACD,OAAO,EAAE;gBACP,sEAAe,CAAC,QAAQ,CAAC,mEAAa,CAAC;gBACvC,wEAAW;aACZ;YACD,eAAe,EAAE,EAChB;SACF,CAAC;OACW,mBAAmB,CAAG;IAAD,0BAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;ACjBS;AACI;AACoB;AACH;AACvB;AACc;AACkB;AAoBvE;IAAA;IAA0B,CAAC;IAAd,WAAW;QAlBvB,+DAAQ,CAAC;YACR,YAAY,EAAE;gBACb,kEAAU;gBACV,sFAAgB;gBAChB,mFAAe;gBACf,4DAAQ;gBACR,0EAAY;gBACX,4FAAkB;aACnB;YACD,OAAO,EAAE;gBACR,kEAAU;gBACV,sFAAgB;gBAChB,mFAAe;gBACf,4DAAQ;gBACR,0EAAY;gBACX,4FAAkB;aACnB;SACF,CAAC;OACW,WAAW,CAAG;IAAD,kBAAC;CAAA;AAAH;;;;;;;;;;;;;;;;;;;;;;;;AC1BkB;AACe;AACiC;AAExC;AACD;AAOjD;IAsBE,uBACS,OAAsB,EACtB,SAAoB,EACnB,EAAe,EAChB,QAAwB,EACxB,SAA0B,EACzB,OAAwB,EACxB,kBAAsC;QANvC,YAAO,GAAP,OAAO,CAAe;QACtB,cAAS,GAAT,SAAS,CAAW;QACnB,OAAE,GAAF,EAAE,CAAa;QAChB,aAAQ,GAAR,QAAQ,CAAgB;QACxB,cAAS,GAAT,SAAS,CAAiB;QACzB,YAAO,GAAP,OAAO,CAAiB;QACxB,uBAAkB,GAAlB,kBAAkB,CAAoB;QAE9C,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,KAAK,QAAQ,EAAE;YAC1C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;YAClB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SACrB;aAAM,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,KAAK,MAAM,EAAE;YAC/C,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;YACpB,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;YACjB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;SACrB;aAAM;YACL,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;YACnC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;YACpB,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;YAClB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;SACpB;QACD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC7B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC;QAC7C,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;IAC1C,CAAC;IAED,sCAAc,GAAd;QAAA,iBAKC;QAJC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;QAC9C,IAAI,CAAC,SAAS,CAAC,SAAS,CAAE,iBAAO;YAC/B,KAAI,CAAC,SAAS,GAAG,OAAO,CAAC;QAC3B,CAAC,CAAC,CAAC;IACL,CAAC;IAED,0BAA0B;IAC1B,iCAAS,GAAT,UAAU,IAAK;QACb,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC;YAC1B,IAAI,EAAE,CAAC,EAAE,EAAE,kEAAU,CAAC,QAAQ,CAAE;YAChC,MAAM,EAAE,CAAC,EAAE,EAAE,kEAAU,CAAC,QAAQ,CAAC;YACjC,QAAQ,EAAE,CAAC,EAAE,EAAE,kEAAU,CAAC,QAAQ,CAAC;YACnC,UAAU,EAAE,CAAC,EAAE,EAAE,kEAAU,CAAC,QAAQ,CAAC;YACrC,KAAK,EAAE,CAAC,EAAE,EAAE,kEAAU,CAAC,QAAQ,CAAC;SACjC,CAAC,CAAC;QACH,IAAG,IAAI,CAAC,MAAM,EAAE;YACd,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC;gBACrB,QAAQ,EAAE,IAAI,CAAC,QAAQ;gBACvB,KAAK,EAAE,IAAI,CAAC,KAAK;aAClB,CAAC;YACF,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAAC;YAC/C,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;SACjC;IACH,CAAC;IAED,2BAA2B;IAE3B,kCAAU,GAAV;QAAA,iBA2BC;QA1BC,IAAI,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,kBAAkB,EAAE,EAAC,KAAK,EAAC,UAAU,EAAC,CAAC,CAAC;QACjF,YAAY,CAAC,YAAY,CAAC,cAAI;YAC5B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAClB,IAAI,IAAI,EAAE;gBACR,IAAI,IAAI,CAAC,OAAO,EAAE;oBAChB,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;wBACrB,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,IAAI;qBAChC,CAAC,CAAC;oBACH,KAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC;oBAC3C,KAAI,CAAC,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC;iBAC3B;qBAAM;oBACL,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;wBACrB,MAAM,EAAE,IAAI;qBACb,CAAC,CAAC;oBACH,KAAI,CAAC,SAAS,GAAG,SAAS,CAAC;iBAC5B;gBACD,IAAI,KAAI,CAAC,KAAK,EAAE;oBACd,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;wBACrB,IAAI,EAAE,EAAE;wBACR,UAAU,EAAE,EAAE;qBACf,CAAC,CAAC;oBACH,KAAI,CAAC,KAAK,GAAG,SAAS,CAAC;iBACxB;aACF;QACH,CAAC,CAAC;QACF,YAAY,CAAC,OAAO,EAAE,CAAC;IACzB,CAAC;IAED,8BAAM,GAAN;QAAA,iBAyBC;QAxBC,IAAI,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;QACzD,YAAY,CAAC,YAAY,CAAC,cAAI;YAC5B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAClB,IAAI,IAAI,EAAE;gBACR,IAAI,IAAI,CAAC,EAAE,EAAE;oBACX,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;oBAC7B,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;wBACrB,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,IAAI;wBAClB,UAAU,EAAE,IAAI,CAAC,EAAE,CAAC,UAAU;wBAC9B,MAAM,EAAE,IAAI,CAAC,EAAE,CAAC,MAAM;qBACvB,CAAC,CAAC;oBACH,KAAI,CAAC,YAAY,GAAG,IAAI,CAAC,EAAE,CAAC;oBAC5B,KAAI,CAAC,SAAS,GAAG,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC;oBACnC,KAAI,CAAC,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC;oBACtB,KAAI,CAAC,gBAAgB,GAAG,KAAI,CAAC,SAAS,CAAC,KAAI,CAAC,SAAS,CAAC,CAAC;iBACxD;qBAAM;oBACL,KAAI,CAAC,MAAM,CAAC,UAAU,CAAC;wBACrB,IAAI,EAAE,IAAI;qBACX,CAAC,CAAC;oBACH,KAAI,CAAC,KAAK,GAAG,SAAS,CAAC;iBACxB;aACF;QACH,CAAC,CAAC;QACF,YAAY,CAAC,OAAO,EAAE,CAAC;IACzB,CAAC;IAED,gCAAQ,GAAR;QACE,IAAI,CAAC,YAAY,EAAE,CAAC;IACtB,CAAC;IAED,sCAAc,GAAd,UAAe,KAAK;QAClB,IAAI,MAAM,GAAG,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,KAAK,EAAC,CAAC,CAAC,CAAC;QACpD,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC;IAC7D,CAAC;IAED,oCAAY,GAAZ;QAAA,iBAiDC;QAhDC,IAAI,MAAM;QACV,IAAI,UAAU,CAAC;QACf,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,IAAI,MAAM;QACV,IAAI,CAAC,MAAM,EAAC,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,EAAC,CAAC,GAAG,GAAG,SAAS,CAAC;QAE3D,IAAG,CAAC,IAAI,CAAC,KAAK,EAAE;YACd,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,CAAC;YAC7B,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;YAC3B,kDAAkD;YAClD,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAC,CAAC,CAAC,CAAC,CAAC;YAChF,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,KAAK,2BAA2B,EAAC,CAAC,MAAM,CAAC,QAAQ,GAAG,4BAA4B,EAAC,CAAC,EAAE,CAAC;YAC/G,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;YACpB,MAAM,CAAC,QAAQ,CAAC,GAAG,WAAW,CAAC;SAChC;aAAM;YACL,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC;YAC3B,2DAA2D;YAC3D,oDAAoD;YACpD,IAAI;YACJ,IAAK,MAAM,CAAC,KAAK,KAAK,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,EAAG;gBACxF,MAAM,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC;aAClF;SACF;QACD,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,EAAE,CAAE;QAC5C,IAAI,CAAC,MAAM,EAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,IAAI,EAAC,CAAC,EAAE,CAAC;QAEzD,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACnB,UAAU,GAAG;gBACX,IAAI,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM;gBAC9B,GAAG,EAAE,EAAE;gBACP,QAAQ,EAAE,EAAE;aACb;YACD,IAAI,IAAI,CAAC,MAAM,EAAE;gBACf,UAAU,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC;gBAC1B,UAAU,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;gBAC/C,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;aAC9B;SACF;aAAM;YACL,UAAU,GAAG,IAAI,CAAC,gBAAgB,CAAC;YACnC,IAAI,IAAI,CAAC,MAAM,EAAG;gBAChB,IAAI,UAAU,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,KAAG,CAAC,CAAC,CAAC,CAAC,EAAE;oBAC5D,UAAU,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;oBAC/C,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;iBAC9B;aACF;SACF;QACD,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,EAAE,UAAU,EAAE,GAAG,EAAE,MAAM,EAAE,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC;aAClF,IAAI,CAAE,cAAM,YAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,EAAvB,CAAuB,CAAC,CAAC;IACxC,CAAC;IAhMU,aAAa;QAJzB,gEAAS,CAAC;YACT,QAAQ,EAAE,kBAAkB;WACG;SAChC,CAAC;6EAwB+B;YACX,mEAAS;YACf,qEAAW;YACN,sEAAc;YACb,mEAAe;YAChB,kEAAe;YACJ,UAAkB;OA7BrC,aAAa,CAmMzB;IAAD,CAAC;AAAA;SAnMY,aAAa,iB","file":"22.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CrmOpFormPage } from './crm-op-form';\n\nimport { PipesModule } from '../../pipes/pipes.module';\n\n@NgModule({\n  declarations: [\n    CrmOpFormPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CrmOpFormPage),\n    PipesModule\n  ],\n  entryComponents: [\n  ]\n})\nexport class CrmOpFormPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/crm-op-form/crm-op-form.module.ts","import { NgModule } from '@angular/core';\nimport { FilterPipe } from './filter/filter';\nimport { MomentFormatPipe } from './moment-format/moment-format';\nimport { FieldFilterPipe } from './field-filter/field-filter';\nimport { SortPipe } from './sort/sort';\nimport { ObjNgforPipe } from './obj-ngfor/obj-ngfor';\nimport { CustomCurrencyPipe } from './custom-currency/custom-currency';\n\n@NgModule({\n  declarations: [\n\t  FilterPipe, \n\t  MomentFormatPipe,\n\t  FieldFilterPipe,\n\t  SortPipe,\n\t  ObjNgforPipe,\n    CustomCurrencyPipe,\n  ],\n  exports: [\n\t  FilterPipe,\n\t  MomentFormatPipe,\n\t  FieldFilterPipe,\n\t  SortPipe,\n\t  ObjNgforPipe,\n    CustomCurrencyPipe,\n  ]\n})\nexport class PipesModule {} \n\n\n// WEBPACK FOOTER //\n// ./src/pipes/pipes.module.ts","import { Component } from '@angular/core';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { IonicPage, NavController, NavParams, ViewController, ModalController } from 'ionic-angular';\n\nimport { CrmDataProvider } from '../../providers';\nimport { CustomCurrencyPipe } from '../../pipes';\n\n@IonicPage()\n@Component({\n  selector: 'page-crm-op-form',\n  templateUrl: 'crm-op-form.html',\n})\nexport class CrmOpFormPage {\n\n  salesReps: any;\n  addPsp: boolean;\n  addNew: boolean;\n  edit: boolean;\n\n  opForm: any;\n  opKey: string;\n\n  updateOpForm: any;\n  // submitType: string;\n  \n  clientObs: any;\n  clientObj: any;\n  clientKey: string;\n  updateClientForm: any;\n  \n  months: any;\n  pspData: any;\n  amount: any;\n\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    private fb: FormBuilder,\n    public viewCtrl: ViewController,\n    public modalCtrl: ModalController,\n    private crmData: CrmDataProvider,\n    private customCurrencyPipe: CustomCurrencyPipe\n  ) {\n    if (this.navParams.data.state === 'addNew') {\n      this.addNew = true;\n      this.edit = false;\n      this.addPsp = false;\n    } else if (this.navParams.data.state === 'edit') {\n      this.addNew = false;\n      this.edit = true;\n      this.addPsp = false;\n    } else {\n      this.pspData = this.navParams.data;\n      this.addNew = false;\n      this.edit = false;\n      this.addPsp = true;\n    }\n    this.buildForm(this.pspData);\n    this.months = this.crmData.buildCloseMonth();\n    this.salesReps = this.crmData.salesReps;\n  }\n\n  ionViewDidLoad() {\n    this.clientObs = this.crmData.getClientsObj();\n    this.clientObs.subscribe( clients => {\n      this.clientObj = clients;\n    });\n  }\n\n  // construye el formulario\n  buildForm(form?) {\n    this.opForm = this.fb.group({\n      obra: ['', Validators.required ],\n      client: ['', Validators.required],\n      salesRep: ['', Validators.required],\n      closeMonth: ['', Validators.required],\n      total: ['', Validators.required],\n    });\n    if(this.addPsp) {\n      this.opForm.patchValue({\n        salesRep: form.salesRep,\n        total: form.total\n      })\n      console.log(form.total, form.total.toString());\n      this.onAmountChange(form.total);\n    }\n  }\n\n  // para llamar a los modals\n\n  lookClient() {\n    let profileModal = this.modalCtrl.create('ClientSelectPage', {pablo:'pelotudo'});\n    profileModal.onDidDismiss(data => {\n      console.log(data);\n      if (data) {\n        if (data.payload) {\n          this.opForm.patchValue({\n            client: data.payload.val().name\n          });\n          this.updateClientForm = data.payload.val();\n          this.clientKey = data.key;\n        } else {\n          this.opForm.patchValue({\n            client: data\n          });\n          this.clientKey = undefined;\n        }\n        if (this.opKey) {\n          this.opForm.patchValue({\n            obra: '',\n            closeMonth: '',\n          });\n          this.opKey = undefined;\n        }\n      }\n    })\n    profileModal.present();\n  }\n\n  lookOp() {\n    let profileModal = this.modalCtrl.create('OpSelectPage');\n    profileModal.onDidDismiss(data => {\n      console.log(data);\n      if (data) {\n        if (data.op) {\n          console.log('viene por aca');\n          this.opForm.patchValue({\n            obra: data.op.obra,\n            closeMonth: data.op.closeMonth,\n            client: data.op.client\n          });\n          this.updateOpForm = data.op;\n          this.clientKey = data.op.clientKey;\n          this.opKey = data.key;\n          this.updateClientForm = this.clientObj[this.clientKey];\n        } else {\n          this.opForm.patchValue({\n            obra: data\n          });\n          this.opKey = undefined;\n        }\n      }\n    })\n    profileModal.present();\n  }\n  \n  onSubmit() {\n    this.saveNewOPPsp();  \n  }\n\n  onAmountChange(event) {\n    let parsed = this.customCurrencyPipe.parse(event,0);\n    this.amount = this.customCurrencyPipe.transform(parsed, 0);\n  }\n\n  saveNewOPPsp() {\n    let opForm\n    let clientForm;\n    let psp = {};\n    let razSoc\n    this.addPsp? psp[this.pspData.num] = true: psp = undefined;\n\n    if(!this.opKey) {\n      console.log('viene por aca');\n      opForm = this.opForm.value;\n      // opForm.total = Number(this.opForm.value.total);\n      opForm.total = Number(this.customCurrencyPipe.parse(this.opForm.value.total,0));      \n      this.opForm.value.salesRep === 'Tarruella Alberto Horacio'? opForm.salesRep = 'Tarruella Alberto Horacio ': '';\n      opForm['psps'] = {};\n      opForm['status'] = 'Pendiente';\n    } else {\n      opForm = this.updateOpForm;\n      // if (opForm.total !== Number( this.opForm.value.total)) {\n      //   opForm.total = Number(this.opForm.value.total);\n      // }\n      if ( opForm.total !== Number(this.customCurrencyPipe.parse(this.opForm.value.total, 0)) ) {\n        opForm.total = Number(this.customCurrencyPipe.parse(this.opForm.value.total, 0));\n      }\n    }\n    !opForm['psps'] ? opForm['psps'] = {} : '' ;\n    this.addPsp? opForm['psps'][this.pspData.num] = true: '';\n\n    if (!this.clientKey) {\n      clientForm = {\n        name: this.opForm.value.client,\n        ops: {},\n        contacts: {}\n      }\n      if (this.addPsp) {\n        clientForm['razSoc'] = [];\n        clientForm['razSoc'].push(this.pspData.razSoc);\n        razSoc = this.pspData.razSoc;\n      }\n    } else {\n      clientForm = this.updateClientForm;\n      if( this.addPsp ) {\n        if (clientForm['razSoc'].indexOf(this.pspData.razSoc)===(-1)) {\n          clientForm['razSoc'].push(this.pspData.razSoc);\n          razSoc = this.pspData.razSoc;\n        }\n      }\n    }\n    this.crmData.saveNewOp(opForm, clientForm, psp, razSoc, this.opKey, this.clientKey)\n    .then( () => this.viewCtrl.dismiss());\n  }\n  \n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/crm-op-form/crm-op-form.ts"],"sourceRoot":""}