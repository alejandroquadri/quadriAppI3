{"version":3,"sources":["../../src/pages/crm-op/crm-op.module.ts","../../src/pipes/pipes.module.ts","../../src/pages/crm-op/crm-op.ts"],"names":[],"mappings":"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","file":"11.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CrmOpPage } from './crm-op';\n\nimport { PipesModule } from '../../pipes/pipes.module'\n\n@NgModule({\n  declarations: [\n    CrmOpPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CrmOpPage),\n    PipesModule\n  ],\n})\nexport class CrmOpPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/crm-op/crm-op.module.ts","import { NgModule } from '@angular/core';\nimport { FilterPipe } from './filter/filter';\nimport { MomentFormatPipe } from './moment-format/moment-format';\nimport { FieldFilterPipe } from './field-filter/field-filter';\nimport { SortPipe } from './sort/sort';\nimport { ObjNgforPipe } from './obj-ngfor/obj-ngfor';\n\n@NgModule({\n  declarations: [\n\t  FilterPipe, \n\t  MomentFormatPipe,\n\t  FieldFilterPipe,\n\t  SortPipe,\n\t  ObjNgforPipe,\n  ],\n  exports: [\n\t  FilterPipe,\n\t  MomentFormatPipe,\n\t  FieldFilterPipe,\n\t  SortPipe,\n\t  ObjNgforPipe,\n  ]\n})\nexport class PipesModule {} \n\n\n// WEBPACK FOOTER //\n// ./src/pipes/pipes.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, PopoverController, ModalController } from 'ionic-angular';\nimport { Observable } from 'rxjs/Observable';\nimport \"rxjs/add/observable/combineLatest\";\nimport * as moment from 'moment';\n\nimport { CrmDataProvider, SplitShowProvider } from '../../providers';\nimport { FieldFilterPipe, FilterPipe, SortPipe } from '../../pipes';\n\n@IonicPage()\n@Component({\n  selector: 'page-crm-op',\n  templateUrl: 'crm-op.html',\n})\nexport class CrmOpPage {\n\n  filtersObs: Observable<any>;\n  opObs: Observable<any>;\n  subs: Observable<any>;\n  months: any;\n  statusOptions = ['Pendiente', 'Rechazado', 'Cerrado'];\n\n\topListCrude: Array<any>;\n  filters: any;\t\n  searchInput: string = '';\n\n  ascTotal = false;\n  ascMonth = true;\n  total: number = 0;\n\n  opList: Array<any>;\n\n  constructor(\n  \tpublic navCtrl: NavController,\n  \tpublic navParams: NavParams,\n  \tprivate crmData: CrmDataProvider,\n  \tprivate splitShow: SplitShowProvider,\n  \tpublic popoverCtrl: PopoverController,\n    public modalCtrl: ModalController,\n    private fieldFilterPipe: FieldFilterPipe,\n    private filterPipe: FilterPipe,\n    private sortPipe: SortPipe\n\t) {\n    this.buildCloseMonth();\n  }\n\n  ionViewDidLoad() {\n    this.opObs = this.crmData.getOpsList();\n    this.filtersObs = this.crmData.filterObs;\n\n    this.subs = Observable.combineLatest(this.opObs, this.filtersObs, (ops: any, filters:any) => ({ops, filters}));\n    this.subs.subscribe( (pair: any) => {\n      this.opListCrude = pair.ops;\n      this.filters = pair.filters;\n      this.filter();\n    })\n  }\n\n  buildCloseMonth() {\n    this.months = [];\n    for (let i = 0; i < 24; i++) {\n      let today =  moment();\n      let item = today.add(i, 'month').format('MM-YYYY');\n      this.months.push(item);\n    }\n  }\n\n  filter() {\n    const fieldsFiltered = this.fieldFilter(this.opListCrude);\n    this.opList = this.filterPipe.transform(fieldsFiltered, this.searchInput, true);\n    this.sort('total', false);\n    this.calcTotal(this.opList);\n  }\n\n  fieldFilter(array: Array<any>) {\n    return array.filter( itemMeta => {\n      let item = itemMeta.payload.val();\n      return (this.statusFilter(item) && this.salesRepFilter(item) && this.monthFilter(item));\n    })\n  }\n\n  calcTotal(array: Array<any>) {\n    // console.log('calculo');\n    this.total = 0;\n    array.forEach( itemM => {\n      let total = +itemM.payload.val().total;\n      this.total += total;\n    })\n  }\n\n  sort(field, asc: boolean) {\n    this.opList =  this.sortPipe.transform(this.opList, field, asc, true);\n  }\n\n  searchBar(event) {\n    this.searchInput = event;\n    this.filter();\n  }\n\n  statusFilter(item) {\n    let fields = this.changeFilters(this.filters.status);\n    for (let j=0, n = fields.length; j < n; j++) {\n      if (item.status.toLowerCase() === fields[j].toLowerCase()) {\n        return true;\n      }\n    }\n  }\n\n  salesRepFilter(item) {\n    let fields = this.changeFilters(this.filters.salesRep);\n    for (let j=0, n = fields.length; j<n; j++) {\n      if (item.salesRep.toLowerCase() === fields[j].toLowerCase()) {\n        return true;\n      }\n    }\n  }\n\n  monthFilter(item) {\n    let month = this.filters.month;\n    if (month === '') {\n      return true;\n    } else {\n      if (item.closeMonth === month) {\n        return true;\n      }\n    }\n    \n  }\n\n  changeFilters(filters: any) {\n    // console.log(filters);\n    const keyArr: any[] = Object.keys(filters);\n    let arrayFilter = [];\n    keyArr.forEach(item => {\n      if(filters[item]) {\n        if (item === 'month') {\n          arrayFilter.push(filters[item])\n        } else if (item === 'roldan') {\n          arrayFilter.push('Alejandra Roldan')\n        } else if (item === 'tarruella') {\n          arrayFilter.push('Tarruella Alberto Horacio ')\n        } else {\n          arrayFilter.push(item);\n        }\n      }\n    })\n    return arrayFilter;\n  }\n\n  changeStatus(status: string, key: string) {\n    this.crmData.updateOp(key, {status: status})\n    .then( () => console.log('status actualizado'));\n  }\n\n  changeCloseMonth(closeMonth: string, key: string) {\n    this.crmData.updateOp(key, {closeMonth: closeMonth})\n    .then( () => console.log('closeMonth actualizado'));\n  }\n\n  seeOp(op: any, key: string) {\n\n  }\n\n  editOp(op: any, key: string) {\n\n  }\n\n  presentFilters(myEvent) {\n    let popover = this.popoverCtrl.create('CrmOpFiltersPage');\n    popover.present({\n      ev: myEvent\n    });\n  }\n\n  presentModal() {\n    let profileModal = this.modalCtrl.create('CrmOpFormPage', {state:'addNew'});\n    profileModal.present();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/crm-op/crm-op.ts"],"sourceRoot":""}